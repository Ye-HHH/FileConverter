<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多功能文件格式转换器</title>
    <!-- 引入Tailwind CSS以实现快速、现代化的UI设计 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 注意：核心库JS文件已从此移除，将由脚本按需动态加载 -->
    <style>
        /* 自定义样式，增强用户体验 */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .tab-button.active {
            border-color: #3B82F6;
            background-color: #3B82F6;
            color: white;
        }
        .drop-zone {
            border: 2px dashed #9CA3AF;
            transition: all 0.3s ease;
        }
        .drop-zone.drag-over {
            border-color: #3B82F6;
            background-color: #EFF6FF;
        }
        /* 加载动画 */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3B82F6;
            border-radius: 50%;
            width: 20px; /* 缩小加载动画尺寸以适应进度条区域 */
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 md:p-8">
        
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white">All-in-One 格式转换器</h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2">纯前端实现，保护您的文件隐私与安全。</p>
        </header>

        <!-- Tab导航 -->
        <div class="flex flex-wrap justify-center border-b border-gray-200 dark:border-gray-700 mb-6">
            <button data-tab="video" class="tab-button active text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 border-transparent hover:bg-gray-100 dark:hover:bg-gray-700 transition">视频转换</button>
            <button data-tab="audio" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 border-transparent hover:bg-gray-100 dark:hover:bg-gray-700 transition">音频转换</button>
            <button data-tab="image" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 border-transparent hover:bg-gray-100 dark:hover:bg-gray-700 transition">图片转换</button>
            <button data-tab="document" class="tab-button text-sm md:text-base font-medium py-3 px-4 md:px-6 border-b-2 border-transparent hover:bg-gray-100 dark:hover:bg-gray-700 transition">图片转PDF</button>
        </div>

        <!-- 转换器内容区域 -->
        <main>
            <!-- 视频转换器 -->
            <div id="video-converter" class="converter-panel">
                <p class="text-center text-gray-600 dark:text-gray-400 mb-4">支持 MP4, MOV, AVI, WEBM 等格式互转。</p>
                <div class="drop-zone rounded-lg p-8 text-center cursor-pointer" id="video-drop-zone">
                    <p class="text-gray-500">拖拽视频文件至此，或 <span class="text-blue-500 font-semibold">点击选择</span></p>
                    <input type="file" id="video-input" class="hidden" accept="video/*">
                </div>
                <div class="mt-4 text-center">
                    <label for="video-format" class="mr-2 font-medium">转换为:</label>
                    <select id="video-format" class="rounded-md border-gray-300 dark:bg-gray-700 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500">
                        <option value="mp4">MP4</option>
                        <option value="webm">WEBM</option>
                        <option value="avi">AVI</option>
                        <option value="mov">MOV</option>
                        <option value="m4v">M4V (苹果兼容)</option>
                        <option value="gif">GIF (动图)</option>
                    </select>
                </div>
                <div class="text-center mt-6">
                    <button id="video-convert-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>开始转换</button>
                </div>
            </div>

            <!-- 音频转换器 -->
            <div id="audio-converter" class="converter-panel hidden">
                <p class="text-center text-gray-600 dark:text-gray-400 mb-4">支持 MP3, WAV, OGG, M4A 等格式互转。</p>
                <div class="drop-zone rounded-lg p-8 text-center cursor-pointer" id="audio-drop-zone">
                    <p class="text-gray-500">拖拽音频文件至此，或 <span class="text-blue-500 font-semibold">点击选择</span></p>
                    <input type="file" id="audio-input" class="hidden" accept="audio/*">
                </div>
                <div class="mt-4 text-center">
                    <label for="audio-format" class="mr-2 font-medium">转换为:</label>
                    <select id="audio-format" class="rounded-md border-gray-300 dark:bg-gray-700 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500">
                        <option value="mp3">MP3</option>
                        <option value="wav">WAV</option>
                        <option value="ogg">OGG</option>
                        <option value="m4a">M4A</option>
                    </select>
                </div>
                <div class="text-center mt-6">
                    <button id="audio-convert-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>开始转换</button>
                </div>
            </div>

            <!-- 图片转换器 -->
            <div id="image-converter" class="converter-panel hidden">
                <p class="text-center text-gray-600 dark:text-gray-400 mb-4">支持 PNG, JPG, WEBP, BMP 等格式互转。</p>
                <div class="drop-zone rounded-lg p-8 text-center cursor-pointer" id="image-drop-zone">
                    <p class="text-gray-500">拖拽图片文件至此，或 <span class="text-blue-500 font-semibold">点击选择</span></p>
                    <input type="file" id="image-input" class="hidden" accept="image/*">
                </div>
                <div class="mt-4 text-center">
                    <label for="image-format" class="mr-2 font-medium">转换为:</label>
                    <select id="image-format" class="rounded-md border-gray-300 dark:bg-gray-700 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500">
                        <option value="png">PNG</option>
                        <option value="jpeg">JPEG</option>
                        <option value="webp">WEBP</option>
                        <option value="bmp">BMP</option>
                    </select>
                </div>
                 <div class="text-center mt-6">
                    <button id="image-convert-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>开始转换</button>
                </div>
            </div>

            <!-- 图片转PDF转换器 -->
            <div id="document-converter" class="converter-panel hidden">
                 <p class="text-center text-gray-600 dark:text-gray-400 mb-4">选择多张图片，将它们合并成一个PDF文件。</p>
                 <div class="drop-zone rounded-lg p-8 text-center cursor-pointer" id="doc-drop-zone">
                    <p class="text-gray-500">拖拽图片文件至此，或 <span class="text-blue-500 font-semibold">点击选择</span></p>
                    <input type="file" id="doc-input" class="hidden" accept="image/*" multiple>
                </div>
                <div id="doc-preview" class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
                 <div class="text-center mt-6">
                    <button id="doc-convert-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>合并为PDF</button>
                </div>
            </div>
            
            <!-- 通用状态和进度条显示区域 -->
            <div id="status-area" class="mt-6 text-center space-y-3 hidden">
                <div class="flex items-center justify-center space-x-2">
                    <div id="status-loader" class="loader hidden"></div>
                    <p id="status-text" class="text-sm text-gray-600 dark:text-gray-400"></p>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        
        let ffmpegLoadPromise = null;
        let jsPDFLoadPromise = null;

        const statusArea = document.getElementById('status-area');
        const progressBar = document.getElementById('progress-bar');
        const statusText = document.getElementById('status-text');
        const statusLoader = document.getElementById('status-loader');
        const tabs = document.querySelectorAll('.tab-button');
        const panels = document.querySelectorAll('.converter-panel');
        const videoDropZone = document.getElementById('video-drop-zone');
        const videoInput = document.getElementById('video-input');
        const videoConvertBtn = document.getElementById('video-convert-btn');
        const videoFormatSelect = document.getElementById('video-format');
        let videoFile = null;
        const audioDropZone = document.getElementById('audio-drop-zone');
        const audioInput = document.getElementById('audio-input');
        const audioConvertBtn = document.getElementById('audio-convert-btn');
        const audioFormatSelect = document.getElementById('audio-format');
        let audioFile = null;
        const imageDropZone = document.getElementById('image-drop-zone');
        const imageInput = document.getElementById('image-input');
        const imageConvertBtn = document.getElementById('image-convert-btn');
        const imageFormatSelect = document.getElementById('image-format');
        let imageFile = null;
        const docDropZone = document.getElementById('doc-drop-zone');
        const docInput = document.getElementById('doc-input');
        const docConvertBtn = document.getElementById('doc-convert-btn');
        const docPreview = document.getElementById('doc-preview');
        let docFiles = [];
        
        function updateProgress(percentage, message, showLoader = false) {
            statusArea.classList.remove('hidden');
            progressBar.style.width = `${percentage}%`;
            statusText.textContent = message;
            statusLoader.classList.toggle('hidden', !showLoader);
            if (message.includes('成功')) {
                progressBar.classList.remove('bg-red-500','bg-blue-600');
                progressBar.classList.add('bg-green-500');
            } else if (message.includes('错误')) {
                progressBar.classList.remove('bg-green-500','bg-blue-600');
                progressBar.classList.add('bg-red-500');
            } else {
                progressBar.classList.remove('bg-green-500', 'bg-red-500');
                progressBar.classList.add('bg-blue-600');
            }
        }
        
        function loadScript(src, timeout = 30000) {
            return new Promise((resolve, reject) => {
                if (document.querySelector(`script[src="${src}"]`)) {
                    return resolve();
                }
                const script = document.createElement('script');
                script.src = src;
                let timer;
                script.onload = () => {
                    clearTimeout(timer);
                    resolve();
                };
                script.onerror = () => {
                    clearTimeout(timer);
                    script.remove();
                    reject(new Error(`脚本加载失败: ${src}`));
                };
                timer = setTimeout(() => {
                    script.remove();
                    reject(new Error(`脚本加载超时 (超过30秒): ${src}`));
                }, timeout);
                document.head.appendChild(script);
            });
        }
        
        async function fetchAndCreateBlobUrl(primaryUrl) {
            const response = await fetch(primaryUrl);
            if (!response.ok) throw new Error(`Fetch failed for ${primaryUrl} with status ${response.status}`);
            const data = await response.blob();
            return URL.createObjectURL(data);
        }


        function getFFmpeg() {
            if (!ffmpegLoadPromise) {
                ffmpegLoadPromise = new Promise(async (resolve, reject) => {
                    try {
                        updateProgress(0, '加载引擎主程序...', true);

                        // 加载 @ffmpeg/ffmpeg 和 @ffmpeg/util（0.12 系列）
                        const ffmpegUrls = [
                            'https://fastly.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js',
                            'https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js'
                        ];
                        const utilUrls = [
                            'https://fastly.jsdelivr.net/npm/@ffmpeg/util@0.12.2/dist/ffmpeg-util.min.js',
                            'https://cdn.jsdelivr.net/npm/@ffmpeg/util@0.12.2/dist/ffmpeg-util.min.js'
                        ];

                        let ffmpegLibLoaded = !!(window.FFmpegWASM && window.FFmpegWASM.FFmpeg);
                        if (!ffmpegLibLoaded) {
                            for (const url of ffmpegUrls) {
                                try {
                                    await loadScript(url);
                                    ffmpegLibLoaded = true;
                                    console.log(`FFmpeg loaded from: ${url}`);
                                    break;
                                } catch (err) {
                                    console.warn(`Failed to load from ${url}:`, err.message);
                                }
                            }
                        }
                        if (!ffmpegLibLoaded) throw new Error('所有CDN都无法访问 @ffmpeg/ffmpeg 库');

                        // 加载 util 以提供 fetchFile（0.12 起从 @ffmpeg/util 提供）
                        let utilLoaded = !!(window.FFmpegUtil && window.FFmpegUtil.fetchFile);
                        if (!utilLoaded) {
                            for (const url of utilUrls) {
                                try {
                                    await loadScript(url);
                                    utilLoaded = !!(window.FFmpegUtil && window.FFmpegUtil.fetchFile);
                                    if (utilLoaded) {
                                        console.log(`FFmpeg util loaded from: ${url}`);
                                        break;
                                    }
                                } catch (err) {
                                    console.warn(`Failed to load util from ${url}:`, err.message);
                                }
                            }
                        }
                        updateProgress(20, '引擎主程序加载完毕...', true);

                        // 适配对象引用
                        const FFmpegClass = window.FFmpegWASM && window.FFmpegWASM.FFmpeg;
                        const fetchFile = (window.FFmpegUtil && window.FFmpegUtil.fetchFile) || (window.FFmpegWASM && window.FFmpegWASM.fetchFile);

                        if (typeof FFmpegClass !== 'function') {
                            throw new Error(`FFmpeg不是构造函数，类型为: ${typeof FFmpegClass}`);
                        }
                        if (typeof fetchFile !== 'function') {
                            throw new Error('未找到 fetchFile（请检查 @ffmpeg/util 是否加载成功）');
                        }

                        // 创建FFmpeg实例
                        const ffmpeg = new FFmpegClass();

                        ffmpeg.on('log', ({ message }) => console.log(message));
                        ffmpeg.on('progress', ({ progress }) => {
                            if (progress >= 0 && progress <= 1) {
                                const overallProgress = 60 + (progress * 40);
                                updateProgress(overallProgress, `正在转换: ${(progress * 100).toFixed(1)}%`, true);
                            }
                        });

                        updateProgress(25, '正在下载核心组件...', true);

                        // 只使用稳定的 jsdelivr CDN 加载核心文件（与 0.12 对齐）
                        const baseURLs = [
                            'https://fastly.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/',
                            'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/'
                        ];

                        let coreLoaded = false;
                        for (const baseURL of baseURLs) {
                            try {
                                await ffmpeg.load({
                                    coreURL: baseURL + 'ffmpeg-core.js',
                                    wasmURL: baseURL + 'ffmpeg-core.wasm',
                                    workerURL: baseURL + 'ffmpeg-core.worker.js'
                                });
                                console.log(`FFmpeg core loaded from: ${baseURL}`);
                                coreLoaded = true;
                                break;
                            } catch (err) {
                                console.warn(`Failed to load core from ${baseURL}:`, err.message);
                            }
                        }
                        if (!coreLoaded) throw new Error('所有CDN都无法访问FFmpeg核心文件');

                        updateProgress(100, '引擎已就绪！');
                        resolve({ ffmpeg, fetchFile });
                    } catch (err) {
                        ffmpegLoadPromise = null;
                        updateProgress(100, `错误：引擎加载失败。 ${err.message}`);
                        reject(err);
                    }
                });
            }
            return ffmpegLoadPromise;
        }

        function getJsPDF() {
            if (!jsPDFLoadPromise) {
                 jsPDFLoadPromise = new Promise(async (resolve, reject) => {
                    try {
                        updateProgress(0, '首次加载PDF生成库...', true);
                        if (!window.jspdf) {
                            const primarySrc = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                            await loadScript(primarySrc);
                        }
                        updateProgress(100, 'PDF库已就绪！');
                        resolve(window.jspdf.jsPDF);
                    } catch(err) {
                        jsPDFLoadPromise = null;
                        updateProgress(100, `错误：PDF库加载失败。 ${err.message}`);
                        reject(err);
                    }
                 });
            }
            return jsPDFLoadPromise;
        }

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetPanel = document.getElementById(`${tab.dataset.tab}-converter`);
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                panels.forEach(p => p.classList.add('hidden'));
                targetPanel.classList.remove('hidden');
                statusArea.classList.add('hidden');
            });
        });

        function setupDropZone(dropZone, input, fileHandler) {
            dropZone.addEventListener('click', () => input.click());
            dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
            dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('drag-over'); });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                if (e.dataTransfer.files.length) {
                    // 直接将 files 作为事件目标传入，避免直接写入只读的 input.files
                    fileHandler({ target: { files: e.dataTransfer.files } });
                }
            });
            input.addEventListener('change', fileHandler);
        }

        setupDropZone(videoDropZone, videoInput, (e) => { videoFile = e.target.files[0]; if (videoFile) { videoDropZone.querySelector('p').textContent = `已选择: ${videoFile.name}`; videoConvertBtn.disabled = false; } });
        setupDropZone(audioDropZone, audioInput, (e) => { audioFile = e.target.files[0]; if (audioFile) { audioDropZone.querySelector('p').textContent = `已选择: ${audioFile.name}`; audioConvertBtn.disabled = false; } });
        setupDropZone(imageDropZone, imageInput, (e) => { imageFile = e.target.files[0]; if (imageFile) { imageDropZone.querySelector('p').textContent = `已选择: ${imageFile.name}`; imageConvertBtn.disabled = false; } });
        setupDropZone(docDropZone, docInput, (e) => {
            docFiles = Array.from(e.target.files);
            docPreview.innerHTML = '';
            if (docFiles.length > 0) {
                docDropZone.querySelector('p').textContent = `已选择 ${docFiles.length} 个文件`;
                docConvertBtn.disabled = false;
                docFiles.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (event) => { const imgEl = document.createElement('img'); imgEl.src = event.target.result; imgEl.className = 'w-full h-auto object-cover rounded-md shadow-sm'; docPreview.appendChild(imgEl); };
                    reader.readAsDataURL(file);
                });
            }
        });
        
        async function handleFFmpegConvert(file, formatSelect, type) {
            if (!file) return;
            try {
                const { ffmpeg, fetchFile } = await getFFmpeg();
                updateProgress(60, '准备转换...', true);

                const outputFilename = `${file.name.split('.').slice(0, -1).join('.')}.${formatSelect.value}`;
                await ffmpeg.writeFile(file.name, await fetchFile(file));
                let args = ['-i', file.name];
                // 对 M4V 使用“重封装”（不重新编码），大幅提高成功率
                if (type === '视频' && formatSelect.value === 'm4v') {
                    try {
                        args.push('-c', 'copy', '-map', '0', '-movflags', 'faststart', '-f', 'mp4', outputFilename);
                        await ffmpeg.exec(args);
                    } catch (e) {
                        // 若重封装失败（例如输入编码不被MP4容器接受），回退到重新编码
                        console.warn('M4V copy 重封装失败，尝试重新编码:', e?.message || e);
                        updateProgress(70, '重封装失败，尝试重新编码...', true);
                        await ffmpeg.exec([
                            '-i', file.name,
                            '-c:v', 'libx264', '-preset', 'veryfast',
                            '-c:a', 'aac', '-b:a', '128k',
                            '-movflags', 'faststart', '-f', 'mp4',
                            outputFilename
                        ]);
                    }
                } else {
                    // 默认策略：让 ffmpeg 根据后缀决定容器/编码
                    args.push(outputFilename);
                    await ffmpeg.exec(args);
                }

                const data = await ffmpeg.readFile(outputFilename);
                const blob = new Blob([data.buffer]);
                const url = URL.createObjectURL(blob);
                triggerDownload(url, outputFilename);

                updateProgress(100, '转换成功！已开始下载。');

                await ffmpeg.deleteFile(file.name);
                await ffmpeg.deleteFile(outputFilename);
            } catch (error) {
                console.error(`${type}转换失败:`, error);
                updateProgress(100, `错误：${type}转换失败。${error.message}`);
            }
        }
        
        videoConvertBtn.addEventListener('click', () => handleFFmpegConvert(videoFile, videoFormatSelect, '视频'));
        audioConvertBtn.addEventListener('click', () => handleFFmpegConvert(audioFile, audioFormatSelect, '音频'));
        
        imageConvertBtn.addEventListener('click', () => {
            if (!imageFile) return;
            updateProgress(0, '正在转换...', true);
            const format = imageFormatSelect.value;
            const mimeType = `image/${format}`;
            const outputFilename = `${imageFile.name.split('.').slice(0, -1).join('.')}.${format}`;
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width; canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    canvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        triggerDownload(url, outputFilename);
                        updateProgress(100, '转换成功！已开始下载。');
                    }, mimeType, 0.95);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(imageFile);
        });

        docConvertBtn.addEventListener('click', async () => {
            if (docFiles.length === 0) return;
            try {
                const jsPDF = await getJsPDF();
                const pdf = new jsPDF('p', 'mm', 'a4');
                for (let i = 0; i < docFiles.length; i++) {
                    const file = docFiles[i];
                    updateProgress((i / docFiles.length) * 100, `正在处理第 ${i + 1} / ${docFiles.length} 张图片...`, true);
                    const imgData = await readFileAsDataURL(file);
                    const img = await loadImage(imgData);
                    const imgProps = pdf.getImageProperties(img);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const ratio = Math.min(pdfWidth / imgProps.width, pdfHeight / imgProps.height);
                    const imgWidth = imgProps.width * ratio;
                    const imgHeight = imgProps.height * ratio;
                    const x = (pdfWidth - imgWidth) / 2;
                    const y = (pdfHeight - imgHeight) / 2;
                    if (i > 0) pdf.addPage();
                    pdf.addImage(img, 'PNG', x, y, imgWidth, imgHeight);
                }
                pdf.save('converted.pdf');
                updateProgress(100, 'PDF生成成功！已开始下载。');
            } catch (error) {
                 console.error("PDF生成失败:", error);
                 updateProgress(100, `错误：PDF生成失败。`);
            }
        });
        
        function triggerDownload(url, filename) { const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); }
        function readFileAsDataURL(file) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.onload = () => resolve(reader.result); reader.onerror = reject; reader.readAsDataURL(file); }); }
        function loadImage(src) { return new Promise((resolve, reject) => { const img = new Image(); img.onload = () => resolve(img); img.onerror = reject; img.src = src; }); }
    });
    </script>
</body>
</html>
